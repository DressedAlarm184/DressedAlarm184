name: Main Linux Enviornment
run-name: DressedAlarm184 Linux Envirornment

on:
  workflow_dispatch:
    inputs:
      command:
        description: "Execute Command"
        required: true
      variables:
        description: "Custom Variables"
        required: false

jobs:
  main:
    runs-on: ubuntu-latest
    env:
      RUNTIME: 0
    steps:
      - name: Create user files
        id: createfiles
        run: |
          echo '${{ vars.script }}' | tr -d '\r' > script.sh
          echo '${{ github.actor }}' > user.txt
    
      - name: Run command
        id: runcommand
        run: |
          IFS=',' read -ra pairs <<< "${{ inputs.variables }}"
          for pair in "${pairs[@]}"; do
              IFS='=' read -r key value <<< "$pair"
              export "$key"="$value"
          done
          RUNTIME=$(($(date +%s%N) / 1000000))
          ${{ inputs.command }}

      - name: Display execution time
        id: executetime
        run: echo "The command finished in $(( $(($(date +%s%N) / 1000000)) - $RUNTIME)) milliseconds"

      - name: Clean up env
        id: cleanup
        run: |
          unset RUNTIME
          echo "Finished..."
          
      - name: Report exit status
        id: reportstatus
        if: always()
        run: echo "Exit status is ${{ steps.runcommand.outcome }}"
